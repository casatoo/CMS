server:
  port: ${SERVER_PORT:8080}
  servlet:
    session:
      timeout: 30m
  error:
    whitelabel:
      enabled: false
    path: /error

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  banner:
    location: classpath:/custom-banner.txt
  application:
    name: CMS
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:cms}?useUnicode=true&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: ${DDL_AUTO:validate}
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MariaDBDialect
        default_batch_fetch_size: 100
        order_inserts: true
        order_updates: true
        jdbc:
          batch_size: 50
        show_sql: false
        format_sql: true
        use_sql_comments: true
  cache:
    type: caffeine
    cache-names:
      - users
      - attendanceSummary
      - dailyAttendance
      - attendanceList
      - leaveDays
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=10m
  jwt:
    secret: ${JWT_SECRET}

resilience4j:
  bulkhead:
    instances:
      MainController_Method3:
        base-config: default
    configs:
      default:
        max-concurrent-calls: 1
        max-wait-duration: 1000ms
  thread-pool-bulkhead:
    instances:
      MainController_Method4:
        base-config: default
    configs:
      default:
        max-thread-pool-size: 10
        core-thread-pool-size: 5
        queue-capacity: 50
  retry:
    instances:
      MainController_Method2:
        base-config: default
    configs:
      default:
        max-attempts: 3
        wait-duration: 10000ms
        retry-exception:
          - java.io.IOException
        ignore-exceptions:

  circuitbreaker:
    configs:
      default:
        sliding-window-type: count_based
        sliding-window-size: 10
        failure-rate-threshold: 20
        minimum-number-of-calls: 5
        slow-call-rate-threshold: 10
        slow-call-duration-threshold: 30000ms
        permitted-number-of-calls-in-half-open-state: 10
        max-wait-duration-in-half-open-state: 0
        wait-duration-in-open-state: 600000ms
        automatic-transition-from-open-to-half-open-enabled: true
        register-health-indicator: true
        ignore-exceptions:
          - java.io.IOException
          - java.util.concurrent.TimeoutException
          - org.springframework.web.client.HttpServerErrorException
    instances:
      MainController_Method1:
        base-config: default

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always
  health:
    circuitbreakers:
      enabled: true

cors:
  allowed: ${CORS_ALLOWED_ORIGINS:http://localhost,http://127.0.0.1,http://localhost:3000}

file:
  upload:
    path: ${FILE_UPLOAD_PATH:/tmp/cms/uploads/profiles}

logging:
  level:
    root: ${LOG_LEVEL_ROOT:INFO}
    io.github.mskim.comm.cms: ${LOG_LEVEL_APP:INFO}
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
